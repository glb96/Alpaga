<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Polarisation Procedure &#8212; Alpaga 1.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=61243dd2"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. SHS analysis" href="analysis_SHS.html" />
    <link rel="prev" title="4. Fitting the Gaussian" href="fitting_procedure.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <blockquote>
<div></div></blockquote>
<section id="polarisation-procedure">
<span id="polarisation-procedure-page"></span><h1><span class="section-number">5. </span>Polarisation Procedure<a class="headerlink" href="#polarisation-procedure" title="Link to this heading">¶</a></h1>
<p>This method regroups the different steps presented previously to automate the analysis.
The aim is to “press a button” to analyze your results while you enjoy a coffee, tea, or hot chocolate.
However, before reaching that level of automation, it is recommended to test and understand the many parameters involved. Many of them can be chosen automatically, but verifying each step yourself ensures reliability.</p>
<p>The main function is <em>analyze_run.polarisation_intensity</em>. Below, we describe the arguments you can pass to this function, corresponding to different steps in the procedure.</p>
<p>This procedure is explained in Part III of the <em>tutorial_spectra_analysis</em> tutorial.</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">analyze_run.</span></span><span class="sig-name descname"><span class="pre">polarisation_intensity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">directory=False,</span> <span class="pre">L_filename=False,</span> <span class="pre">prefix_file=False,</span> <span class="pre">L_files_angles=False,</span> <span class="pre">N_iter=False,</span> <span class="pre">extension='.dat',</span> <span class="pre">fct_name=&lt;function</span> <span class="pre">standard_file_name&gt;,</span> <span class="pre">type_cleaning='mean',</span> <span class="pre">L_mean_cleaning_n=[1,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">3],</span> <span class="pre">L_mean_cleaning_evo_max=[2,</span> <span class="pre">1.5,</span> <span class="pre">1.4,</span> <span class="pre">1.3],</span> <span class="pre">automatic_l_cut=True,</span> <span class="pre">l_cut=[380,</span> <span class="pre">395,</span> <span class="pre">419,</span> <span class="pre">433],</span> <span class="pre">l_cut_n_n2=[2,</span> <span class="pre">9],</span> <span class="pre">order_fit_noise=4,</span> <span class="pre">method_fit_first='fit_gauss',</span> <span class="pre">bounds_fit_gausse=([0,</span> <span class="pre">395,</span> <span class="pre">1],</span> <span class="pre">[inf,</span> <span class="pre">410,</span> <span class="pre">25]),</span> <span class="pre">lambda_0_ref=403,</span> <span class="pre">waist_ref=2,</span> <span class="pre">exclu_zone=False,</span> <span class="pre">fixed_para_gauss_fit=True,</span> <span class="pre">method_fit_second='fit_gauss',</span> <span class="pre">save_result=True,</span> <span class="pre">name_save_result='./post_prod_results.p',</span> <span class="pre">waiting_time=False,</span> <span class="pre">show_figure=True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/analyze_run.html#polarisation_intensity"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd></dd></dl>

<section id="overview-of-the-procedure">
<h2><span class="section-number">5.1. </span>Overview of the procedure<a class="headerlink" href="#overview-of-the-procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Open all the files and verify they are correctly read using <em>alpaga.find_angle_iter_from_dir</em> (see <a class="reference internal" href="file_management.html#file-management-page"><span class="std std-ref">File Management</span></a>).
This step can be bypassed if you define custom values.</p></li>
<li><p>Perform a first analysis for all polarization angles. For each angle, the function will:
a) clean and average the acquisition,
b) remove the noise,
c) fit the Gaussian peak.</p></li>
<li><p>Perform a second analysis, similar to step 2, where some Gaussian fit parameters can be fixed to the average values. This step is optional.</p></li>
<li><p>Save the results in a dictionary.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/alpaga_beau_1.jpg"><img alt="_images/alpaga_beau_1.jpg" class="align-center" src="_images/alpaga_beau_1.jpg" style="width: 450px;" />
</a>
</section>
<section id="file-selection">
<h2><span class="section-number">5.2. </span>File selection<a class="headerlink" href="#file-selection" title="Link to this heading">¶</a></h2>
<p>This function expects data organized by polarization angle. See the <a class="reference internal" href="file_management.html#file-management-page"><span class="std std-ref">File Management</span></a> for details. You can either: 1) rely on automatic file detection by Alpaga (see <em>tutorial_spectra_analysis</em> III.A), 2) provide all the information alongside your filename construction (see <em>tutorial_spectra_analysis</em> III.B), or 3) provide the filenames directly (see <em>tutorial_spectra_analysis</em> III.C).</p>
<ol class="arabic simple">
<li><p>Only requires <strong>directory</strong> (automatic detection).</p></li>
<li><p>Requires <strong>prefix_file</strong>, <strong>L_files_angles</strong>, <strong>N_iter</strong>, and <strong>extension</strong>. Optionally, <strong>fct_name</strong> depending on your filename convention.</p></li>
<li><p>Requires <strong>L_filename</strong>, <strong>L_files_angles</strong>, and <strong>N_iter</strong> (direct file paths).</p></li>
</ol>
<ul class="simple">
<li><p><strong>directory</strong>: str or bool
Directory containing the data to analyze. Only one experiment per directory is recommended.
If set to False, the function will not search for files automatically; you must provide <em>prefix_file</em>, <em>L_files_angles</em>, <em>N_iter</em>, and <em>extension</em>.</p></li>
<li><p><strong>prefix_file</strong>: str or bool
If False, the prefix is determined automatically. Otherwise, the string is used as the global file prefix.</p></li>
<li><p><strong>L_files_angles</strong>: list or bool
If False, the angles are determined automatically. Otherwise, the provided list is used.</p></li>
<li><p><strong>N_iter</strong>: int or bool
Number of acquisitions per angle. Can be provided manually or determined automatically.</p></li>
<li><p><strong>extension</strong>: str
File extension, default is ‘.dat’.</p></li>
<li><p><strong>fct_name</strong>: function
Function to build filenames. Default is <em>file_management.standard_file_name</em>. See <a class="reference internal" href="file_management.html#file-management-page"><span class="std std-ref">File Management</span></a> for alternative naming schemes.</p></li>
<li><p><strong>L_filename</strong>: list of lists of strings
If your files use a non-standard naming convention, provide the full paths for each angle and iteration.
See <a class="reference internal" href="file_management.html#file-management-page"><span class="std std-ref">File Management</span></a> for details and section III.C of <em>tutorial_spectra_analysis</em> for example usage.</p></li>
</ul>
</section>
<section id="averaging-and-cleaning">
<h2><span class="section-number">5.3. </span>Averaging and cleaning<a class="headerlink" href="#averaging-and-cleaning" title="Link to this heading">¶</a></h2>
<p>Cleaning parameters are applied for each angle:</p>
<ul class="simple">
<li><p><strong>type_cleaning</strong>: str, default ‘mean’</p></li>
<li><p><strong>L_mean_cleaning_n</strong>: list</p></li>
<li><p><strong>L_mean_cleaning_evo_max</strong>: list</p></li>
</ul>
<p>For details, see <a class="reference internal" href="cleaning_averaging_spectra.html#cleaning-averaging-spectra-page"><span class="std std-ref">Cleaning and Averaging Spectra</span></a>.</p>
</section>
<section id="noise-removal-and-gaussian-fit">
<h2><span class="section-number">5.4. </span>Noise removal and Gaussian fit<a class="headerlink" href="#noise-removal-and-gaussian-fit" title="Link to this heading">¶</a></h2>
<section id="overview">
<h3><span class="section-number">5.4.1. </span>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h3>
<p>This section describes the <strong>noise management and Gaussian extraction</strong>. These numerical steps have the largest impact on the results, so Alpaga provides a semi-automatic procedure to reduce operator choices and improve reproducibility.</p>
<ul class="simple">
<li><p>Spectra are processed per polarization angle.</p></li>
<li><p>The goal is to extract <strong>peak intensity</strong>, <strong>central wavelength λ₀</strong>, and <strong>Gaussian width (waist)</strong>.</p></li>
<li><p>The process is performed in <strong>two runs</strong> for robustness and to allow automated <em>l_cut</em> selection.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/alpaga_beau_2.jpg"><img alt="_images/alpaga_beau_2.jpg" class="align-center" src="_images/alpaga_beau_2.jpg" style="width: 450px;" />
</a>
</section>
<section id="input-parameters">
<h3><span class="section-number">5.4.2. </span>Input parameters<a class="headerlink" href="#input-parameters" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>l_cut</strong>: list of 4 numbers
Defines the initial noise and signal regions. See <a class="reference internal" href="fitting_procedure.html#remove-noise-section"><span class="std std-ref">alpaga.remove_noise function</span></a>.</p></li>
<li><p><strong>order_fit_noise</strong>: int
Polynomial order for fitting the noise in the spectra.</p></li>
<li><p><strong>bounds_fit_gausse</strong>: list or tuple
Bounds for Gaussian curve fitting. See <a class="reference internal" href="fitting_procedure.html#gaussian-fit-section"><span class="std std-ref">alpaga.fit_gaussian_from_noise function</span></a>.</p></li>
<li><p><strong>lambda_0_ref</strong>: float
Reference lambda_0 used in the integral method.</p></li>
<li><p><strong>waist_ref</strong>: float
Reference waist used in the integral method.</p></li>
<li><p><strong>method_fit_first</strong>: str (<span class="incremental">‘fit_gauss’</span> or <span class="incremental">‘integral_gauss’</span>)
Controls the method for the first run to extract Gaussian parameters.</p></li>
<li><p><strong>automatic_l_cut</strong>: bool
If True, a second analysis for each angle is performed using lambda_0 and waist from the first run.</p></li>
<li><p><strong>l_cut_n_n2</strong>: list <span class="incremental">[n, n2]</span>
Parameters defining the Gaussian-based regions for automatic <em>l_cut</em>.</p></li>
<li><p><strong>fixed_para_gauss_fit</strong>: bool
If True, a second run is performed with lambda_0 and waist fixed to mean values.</p></li>
<li><p><strong>method_fit_second</strong>: str (<span class="incremental">‘fit_gauss’</span>, <span class="incremental">‘integral_gauss’</span> or <span class="incremental">‘both’</span>)
Method for the second run where lambda_0 and waist are fixed.</p></li>
<li><p><strong>exclu_zone</strong>: &#64;MAXIME
EXCLUZONE TODO</p></li>
<li><p><strong>show_figure</strong>: bool
If True, figures are shown. Controls <span class="incremental">show_figure_fit_gauss</span> internally.</p></li>
</ul>
</section>
<section id="first-run">
<h3><span class="section-number">5.4.3. </span>First run<a class="headerlink" href="#first-run" title="Link to this heading">¶</a></h3>
<p>The <strong>first run</strong> processes each angle to determine Gaussian parameters and optionally define automatic <em>l_cut</em>.</p>
<ol class="arabic simple">
<li><p>If <span class="incremental">automatic_l_cut=False</span>
- Uses the <em>l_cut</em> values directly.
- Removes noise and fits Gaussian for each angle.</p></li>
<li><p>If <span class="incremental">automatic_l_cut=True</span>
- In addition, computes lambda_0 and waist for each angle using initial <em>l_cut</em>.</p></li>
</ol>
<ul class="simple">
<li><p><strong>Output parameters per angle</strong>:
- <span class="incremental">L_intensity_angle</span>: Gaussian peak intensity
- <span class="incremental">L_lambda_0_angle</span>: lambda_0
- <span class="incremental">L_waist_angle</span>: Gaussian waist
- Error estimates for each above
- <span class="incremental">LL_noise_param</span>: polynomial coefficients for noise fit</p></li>
</ul>
</section>
<section id="second-run">
<h3><span class="section-number">5.4.4. </span>Second run<a class="headerlink" href="#second-run" title="Link to this heading">¶</a></h3>
<p>The <strong>second run</strong> is optional (<span class="incremental">fixed_para_gauss_fit=True</span>) and fixes lambda_0 and waist to their mean values across all angles. First, it recalculates <em>l_cut</em> based on <span class="incremental">[lambda_0 - n2*waist, lambda_0 - n*waist, lambda_0 + n*waist, lambda_0 + n2*waist]</span> with the value obtained in the first run. Then, it performs a second fit using this Gaussian-based <em>l_cut</em>.</p>
<ul class="simple">
<li><p><strong>Method</strong>: controlled by <span class="incremental">method_fit_second</span>.
- <span class="incremental">‘fit_gauss’</span>: curve fitting with lambda_0 and waist fixed, only intensity free.
- <span class="incremental">‘integral_gauss’</span>: integral method using mean waist.
- <span class="incremental">‘both’</span>: performs both analyses.</p></li>
<li><p><strong>Automatic l_cut</strong>: if <span class="incremental">automatic_l_cut=True</span>, <em>l_cut</em> is recalculated using mean lambda_0 and waist.</p></li>
<li><p><strong>Output parameters per angle</strong>:
- <span class="incremental">L_intensity_fit_gauss_fixed_para</span> and <span class="incremental">_error</span>
- <span class="incremental">L_intensity_integral_gauss_fixed_para</span> and <span class="incremental">_error</span></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The second run ensures more consistent intensity measurements across angles and is particularly useful when using the integral method.</p>
</div>
</section>
<section id="recommendation">
<h3><span class="section-number">5.4.5. </span>Recommendation<a class="headerlink" href="#recommendation" title="Link to this heading">¶</a></h3>
<p>We recommend using the intensity computed after the second run, with fixed lambda_0 and waist:</p>
<ul class="simple">
<li><p><span class="incremental">method_fit_first = ‘fit_gauss’</span></p></li>
<li><p><span class="incremental">automatic_l_cut = True</span></p></li>
<li><p><span class="incremental">method_fit_second = ‘fit_gauss’</span></p></li>
<li><p><span class="incremental">fixed_para_gauss_fit = True</span></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This combination is recommended because the first run with ‘fit_gauss’ reliably determines lambda_0 and waist, the automatic_l_cut ensures robust noise areas, and the second run with fixed parameters avoids angle-dependent fluctuations.</p>
</div>
<p>The obtained intensity is saved as: <span class="incremental">L_post_prod[‘L_intensity_fit_gauss_fixed_para’]</span>.</p>
</section>
</section>
<section id="saving-results">
<h2><span class="section-number">5.5. </span>Saving results<a class="headerlink" href="#saving-results" title="Link to this heading">¶</a></h2>
<p>The results and input arguments are saved in a dictionary, which can also be exported as a pickle file.</p>
<ul>
<li><p><strong>save_result</strong>: bool
If True, results are saved using the name specified in <em>name_save_result</em>.</p></li>
<li><p><strong>name_save_result</strong>: str
Full path to the pickle file where results and parameters are stored.
Must end with ‘.p’. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name_save_result</span> <span class="o">=</span> <span class="s1">&#39;/home/lama/Datas/Results/my_results.p&#39;</span>
</pre></div>
</div>
</li>
</ul>
<p>Once saved, the results can be loaded in Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name_save_result</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filetoload</span><span class="p">:</span>
    <span class="n">L_post_prod_load</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filetoload</span><span class="p">)</span>
</pre></div>
</div>
<p>Key entries in the dictionary:</p>
<ul class="simple">
<li><p><strong>L_intensity_angle</strong>: intensity <em>I0</em> for each angle (first analysis)</p></li>
<li><p><strong>L_lambda_0_angle</strong>: Gaussian peak position for each angle (first analysis)</p></li>
<li><p><strong>L_waist_angle</strong>: Gaussian width for each angle (first analysis)</p></li>
</ul>
<p>If <em>automatic_l_cut</em> = True, these correspond to the second noise-removal analysis using <em>n</em> and <em>n2</em>.</p>
<p>Second analysis (if <em>fixed_para_gauss_fit</em> = True):</p>
<ul class="simple">
<li><p><strong>L_intensity_angle_fit_gauss_fixed_para</strong>: intensity with Gaussian fit, <em>lambda_0</em> and <em>waist</em> fixed</p></li>
<li><p><strong>L_intensity_angle_integral_gauss_fixed_para</strong>: intensity using integral method with <em>lambda_0</em> and <em>waist</em> fixed</p></li>
</ul>
<p>Other saved information:</p>
<ul class="simple">
<li><p><strong>LL_noise_param</strong>: polynomial coefficients for noise fits</p></li>
</ul>
</section>
<section id="other-parameters">
<h2><span class="section-number">5.6. </span>Other parameters<a class="headerlink" href="#other-parameters" title="Link to this heading">¶</a></h2>
<p>While the function is running, several plots and messages are displayed. These are meant to help monitor the analysis and debug if necessary.</p>
<ul class="simple">
<li><p><strong>waiting_time</strong>: float or bool
If set to a float, the function pauses this many seconds between each angle to allow inspection of plots.
If False, the code runs without intentional pauses.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/alpaga_19.jpg"><img alt="_images/alpaga_19.jpg" class="align-left" src="_images/alpaga_19.jpg" style="width: 150px;" />
</a>
<dl class="field-list simple">
<dt class="field-odd">Release<span class="colon">:</span></dt>
<dd class="field-odd"><p>1.2</p>
</dd>
<dt class="field-even">Date<span class="colon">:</span></dt>
<dd class="field-even"><p>Aug 26, 2025</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/alpaga_logo.svg" alt="Logo of Alpaga"/>
            </a></p>
<h1 class="logo"><a href="index.html">Alpaga</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_management.html">2. File Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="cleaning_averaging_spectra.html">3. Cleaning and Averaging Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitting_procedure.html">4. Fitting the Gaussian</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Polarisation Procedure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-the-procedure">5.1. Overview of the procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-selection">5.2. File selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#averaging-and-cleaning">5.3. Averaging and cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#noise-removal-and-gaussian-fit">5.4. Noise removal and Gaussian fit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">5.4.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-parameters">5.4.2. Input parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-run">5.4.3. First run</a></li>
<li class="toctree-l3"><a class="reference internal" href="#second-run">5.4.4. Second run</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recommendation">5.4.5. Recommendation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#saving-results">5.5. Saving results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-parameters">5.6. Other parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="analysis_SHS.html">6. SHS analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis_SSHG.html">7. SSHG analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_advice.html">8. Python advice</a></li>
<li class="toctree-l1"><a class="reference internal" href="experimental_advice.html">9. Experimental and procedure advice</a></li>
<li class="toctree-l1"><a class="reference internal" href="for_developpers.html">10. For Developpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="devs_page.html">11. Alpaga’s developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">12. Reference</a></li>
</ul>


<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;L-GPL.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/polarisation_procedure.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>